# ì„œìš¸ì‹œì˜ í•«í”Œë ˆì´ìŠ¤ëŠ” ì–´ë””? (1/2)

*ì„œìš¸ ì‹œì˜ ìœ ë™ì¸êµ¬, ê°€ê²Œ, SNS ë°ì´í„° ë“±ì„ í™œìš©í•˜ì—¬ ì‹œê°í™”í•´ë³´ëŠ” í”„ë¡œì íŠ¸ì´ë‹¤.*

# 1. Introduction

---

*ì‹œê°í™”ë¥¼ ì‹œì‘í•´ë³´ì*

![Untitled 1](https://user-images.githubusercontent.com/37128004/197394643-130dd543-c124-40fb-952d-d06c473fa763.png)

[https://www.urbanbrush.net/downloads/ì„œìš¸ì§€ë„-ì»¬ëŸ¬-ì¼ëŸ¬ìŠ¤íŠ¸-ai-ë‹¤ìš´ë¡œë“œ-download-seoul-color-map-vector/](https://www.urbanbrush.net/downloads/%EC%84%9C%EC%9A%B8%EC%A7%80%EB%8F%84-%EC%BB%AC%EB%9F%AC-%EC%9D%BC%EB%9F%AC%EC%8A%A4%ED%8A%B8-ai-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-download-seoul-color-map-vector/)

<aside>
ğŸ˜®   ì„œìš¸ì‹œì—ì„œ ê½¤ ì˜¤ë˜ ì‚´ì•˜ì§€ë§Œ ì•„ì§ ê°€ë³´ì§€ ëª»í•œ ì§€ì—­ë“¤ì´ ë§ë‹¤. 

  ëŒ€í•œë¯¼êµ­ ë¬¸í™”ì˜ ì¤‘ì‹¬ì§€ì¸ë§Œí¼ ìˆ˜ë§ì€ ì¦ê¸¸ê±°ë¦¬ê°€ ìˆê³  ì‚¬ëŒë“¤ì´ íŠ¹íˆ ëª¨ì´ëŠ” ì¼ëª… â€˜**í•«í”Œë ˆì´ìŠ¤**â€™ê°€ ì„œìš¸ì‹œì— ìˆ˜ì—†ì´ ë§ì´ ìˆë‹¤. 

  **ê·¸ë ‡ë‹¤ë©´ â€˜ë°ì´í„°ë¡œ ì„œìš¸ì‹œì˜ í•«í”Œë ˆì´ìŠ¤ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ?â€™ í•˜ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.** 

  ì§€ê¸ˆë¶€í„° ì„œìš¸ì‹œì˜ **1) ìœ ë™ì¸êµ¬, 2) ê°€ê²Œ, 3) ì¸ìŠ¤íƒ€ê·¸ë¨ ë°ì´í„°** ë¥¼ í™œìš©í•˜ì—¬ ì„œìš¸ì‹œì˜ í•«í”Œë ˆì´ìŠ¤ëŠ” ì–´ë””ì¸ì§€ í™•ì¸í•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³´ê³ ì í•œë‹¤.

</aside>

# 2. ìœ ë™ì¸êµ¬

---

*í•«í”Œë ˆì´ìŠ¤ì—” ì‚¬ëŒì´ ë§ì§€ ì•Šì„ê¹Œâ€¦â€¦*

ì‚¬ì‹¤, í•«í”Œë ˆì´ìŠ¤ë¼ê³  ì‚¬ëŒì´ ë¬´ì¡°ê±´ ë§ì€ ê²ƒì€ ì•„ë‹ˆê¸´ í•˜ë‹¤. 

ì†Œìœ„ ìš°ë¦¬ê°€ ë§í•˜ëŠ” í•«í”Œë ˆì´ìŠ¤ëŠ” ë‹¨ê¸°ê°„ì— TVì—ì„œ ê¸‰ë¶€ìƒí•˜ê±°ë‚˜, í˜¹ì€ ì¸ìŠ¤íƒ€ê°™ì€ SNSì—ì„œ í•«í•˜ë‹¤ê³  ì…ì†Œë¬¸ì´ ë‚œ ê°€ê²Œë‚˜ ë†€ ì¥ì†Œë¥¼ ë§í•œë‹¤. 

ë¬¼ë¡  ê·¸ì¤‘ì—ëŠ” ë¡±ëŸ°í•˜ëŠ” ê²½ìš°ë„ ìˆì§€ë§Œ ë°˜ì§(?)í•˜ëŠ” ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ì¼ ê²ƒì´ë‹¤. 

í•˜ì§€ë§Œ ê·¸ëŸ° ë‹¨ê¸°ì ì¸ ê²½ìš°ëŠ” ìºì¹˜í•˜ê¸° ì‰½ì§€ ì•Šë‹¤. 

<aside>
ğŸ˜† ê·¸ë˜ì„œ â€˜**ì‚¬ëŒì´ ë§ì´ ëª°ë¦¬ëŠ” ê³³ì´ í•«í”Œë ˆì´ìŠ¤ì´ì§€ ì•Šì„ê¹Œ?**â€™ ë¼ëŠ” ìƒê°ì—ì„œ ì¶œë°œí•´ë³´ì•˜ë‹¤.

</aside>

## ì„œìš¸ì‹œ ìƒí™œì´ë™ ë°ì´í„° ì‹œê°í™”

---

![[https://data.seoul.go.kr/livPopu/html/dashboard.html](https://data.seoul.go.kr/livPopu/html/dashboard.html)](%E1%84%89%E1%85%A5%E1%84%8B%E1%85%AE%E1%86%AF%E1%84%89%E1%85%B5%E1%84%8B%E1%85%B4%20%E1%84%92%E1%85%A1%E1%86%BA%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%83%E1%85%B5%20(1%202)%209d6046a2385748d69e039c32b4c53ab0/Untitled%201.png)

[https://data.seoul.go.kr/livPopu/html/dashboard.html](https://data.seoul.go.kr/livPopu/html/dashboard.html)

ë‹¤ìŒì€ ì„œìš¸ì‹œì˜ ìƒí™œì´ë™ ë°ì´í„°ë¥¼ ì´ìš©í•´ ì‹œê°í™”í•œ ê²°ê³¼ë¬¼ì´ë‹¤. 

| ëŒ€ìƒì—°ì›” | ìš”ì¼ | ë„ì°©ì‹œê°„ | ì¶œë°œ í–‰ì •ë™ ì½”ë“œ | ë„ì°© í–‰ì •ë™ ì½”ë“œ | ì„±ë³„ | ë‚˜ì´ | ì´ë™ìœ í˜• | í‰ê·  ì´ë™ ì‹œê°„(ë¶„) | ì´ë™ì¸êµ¬(í•©) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 202201 | ì¼ | 9 | 1101053 | 1101053 | F | 0 | EE | 10 | 27.77 |
| 202201 | ì¼ | 9 | 1101053 | 1101053 | F | 10 | EE | 10 | 5.96 |
| 202201 | ì¼ | 9 | 1101053 | 1101053 | F | 15 | EE | 10 | 4.07 |
| 202201 | ì¼ | 9 | 1101053 | 1101053 | F | 20 | EE | 10 | 4.38 |
| 202201 | ì¼ | 9 | 1101053 | 1101053 | F | 25 | HH | 10 | * |
| 202201 | ì¼ | 9 | 1101053 | 1101053 | F | 25 | HE | 10 | * |

ì´ë ‡ê²Œ ìƒê¸´ ë°ì´í„°ë¥¼ ê°„ë‹¨í•˜ê²Œ ì‹œê°í™”í•´ë†“ì€ ê²°ê³¼ì¸ ê²ƒì´ë‹¤. 

ì²˜ìŒì˜ ëª©í‘œëŠ” ë¹„ìŠ·í•˜ê²Œ ìƒˆë¡œ êµ¬í˜„í•´ë³´ìâ€¦. ì˜€ì§€ë§Œ ëª…ìƒ‰ì´ â€˜í•«í”Œë ˆì´ìŠ¤â€™ë¥¼ ì‹œê°í™”í•´ë³´ì ì¸ë° ê¸°ì¡´ì˜ ì‹œê°í™”ëŠ” êµ¬ ë‹¨ìœ„ë¡œ ì–´ë–»ê²Œ ì´ë™í–ˆëŠ”ì§€ ë§Œì„ ë³´ì—¬ì£¼ê³  ìˆë‹¤. 

ê·¸ë˜ì„œ ê¸°ì¡´ê³¼ëŠ” ì¢€ ë‹¤ë¥´ê²Œ, í•˜ì§€ë§Œ í˜„ì‹¤ì ì¸ ë¬¸ì œì™€ íƒ€í˜‘í•˜ë©° ë°ì´í„°ë¥¼ ìˆ˜ì •í–ˆë‹¤. ê·¸ ê²°ê³¼,

<aside>
âœ… 1) ê¸°ê°„ì€ **2022ë…„ 1ì›”ë¶€í„° 6ì›”**

2) ****ì‚¬ìš©í•œ ì»¬ëŸ¼ì€ **ëŒ€ìƒì—°ì›”**, **ìš”ì¼, ì‹œê°„, ì¶œë°œ ë° ë„ì°© í–‰ì •ë™ ì½”ë“œ, ì´ë™ìœ í˜•, ì´ë™ì¸êµ¬(í•©)**

3) **ì‹œê°„ëŒ€ëŠ” 6ê°œì˜ ì‹œê°„ëŒ€ë¡œ í•©ì¹˜ê³  ë‚˜ì´ëŒ€ëŠ” 2030, ì§‘ê³¼ ì§ì¥ì´ ëª©ì ì¸ ì´ë™ìœ í˜•ì„ ì œì™¸í•˜ê³  ë‚¨ì€ ìœ í˜•(EE, HE, WE)**ë§Œ ì‚¬ìš©í•˜ì˜€ë‹¤. 

4) **êµ¬ ë‹¨ìœ„ê°€ ì•„ë‹Œ í–‰ì •ë™ ë‹¨ìœ„**ë¡œ groupby í•´ì£¼ì—ˆë‹¤.(~~ì´ê²ƒì´ ì„¸ë¶„í™”ì˜ í•œê³„ì§€ë§Œ ì—¬ì „íˆ í•«í”Œë ˆì´ìŠ¤ë¡œ ë³´ê¸°ì— ì–´ë µê¸´ í•˜ë‹¤..~~)

****5) ****ì›¹ì‚¬ì´íŠ¸ë¡œ ì˜¬ë¦¬ëŠ” ê³¼ì •ì—ì„œ **~~ë©”ëª¨ë¦¬ì˜ í•œê³„~~**ê°€ ë°œìƒí•˜ì—¬ **ì—¬ì„± ë°ì´í„°ë§Œ í™œìš©í•˜ê³  ì„±ë³„ ì»¬ëŸ¼ì„ ì—†ì•´ê³ ** 
    í•«í”Œë ˆì´ìŠ¤ì™€ ê´€ë ¨ ì—†ì–´ ë³´ì´ëŠ” **ìƒˆë²½ ì‹œê°„ëŒ€ì™€ ì´ë™ì¸êµ¬ 3 ì´í•˜ ë°ì´í„°ëŠ” ì‚­ì œ**í•´ì£¼ì—ˆë‹¤.

</aside>

## Pydeck & Dash

---

ì‹œê°í™”ë¥¼ ìœ„í•´ ì‚¬ìš©í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” **pydeck, dash**ì™€ ì´ ë‘˜ì„ í•©ì¹œ **dash_deck**ì´ë‹¤. 

**pydeck**ì€ ê°•ë ¥í•œ ì‹œê°í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ê³  **dash**ëŠ” interactiveí•œ í™”ë©´ì„ ë§Œë“¤ì–´ì£¼ëŠ” ëŒ€ì‹œë³´ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. 

**dash_deck**ì€ ì´ ë‘˜ì„ ì—°ê²°í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. 

ê¸°ì¡´ì˜ ì‹œê°í™”ëŠ” **ì‚°ëœ»í•œ** ëŠë‚Œì´ì˜€ë‹¤ë©´ ì´ë²ˆì—” pydeck íŠ¹ìœ ì˜ **ê²€ê³  ì„¸ë ¨ëœ ëŠë‚Œ**ì„ ì£¼ê³ ìí–ˆë‹¤. 

mapbox api tokenì€ mapbox í™ˆí˜ì´ì§€ì—ì„œ ê°€ì…í•˜ë©´ ì‰½ê²Œ ë°›ì„ ìˆ˜ ìˆë‹¤. 

[Maps, geocoding, and navigation APIs & SDKs | Mapbox](https://www.mapbox.com/)

```python
import pandas as pd
import numpy as np
import os
import pickle
import geopandas as gpd
from tqdm import tqdm 
os.chdir('F:/Competitions/SeoulHotPlace')
mapbox_api_token = 'pk.eyJ1IjoiYm94Ym94NCIsImEiOiJjbDdoY2J1bm8wNzlrM3BycDQzYmduNTJtIn0.Q7koz2UNld3b1xmqF7-KXA'
```

## Preprocessing

---

### 1) í–‰ì •ë™ ê²½ê³„ íŒŒì¼ë¡œ ê¸°ì¤€ ì¢Œí‘œ ì„¤ì •í•˜ê¸°

layerë¥¼ ê·¸ë¦¬ê¸° ìœ„í•˜ì—¬ ê° í–‰ì •ë™ì˜ ê°€ìš´ë° ì¢Œí‘œë¥¼ êµ¬í•´ ì¶œë°œì ê³¼ ë„ì°©ì ìœ¼ë¡œ í™œìš©í•˜ì˜€ë‹¤. 

```python
### 1. ëŒ€í•œë¯¼êµ­ í–‰ì •ë™ ê²½ê³„ íŒŒì¼ 
# https://github.com/vuski/admdongkor/tree/master/ver20220401

geo_data = 'dataset/HangJeongDong_ver20220401.txt'
with open(geo_data,encoding="UTF-8") as json_file:
    df = gpd.read_file(json_file)

df = df.iloc[:,[0,1,2,10]]

def multipolygon_to_coordinates(x):
    lon, lat = x[0].exterior.xy
    return [[x, y] for x, y in zip(lon, lat)]
df['coordinates'] = df['geometry'].apply(multipolygon_to_coordinates)
del df['geometry']

## ê° í–‰ì •ë™ ë³„ ê°€ìš´ë° ì¢Œí‘œ ìƒì„± 
lst = []
for i in df['coordinates']:
    idx_1 = 0
    idx_2 = 0
    for j in i:
        idx_1 += j[0]
        idx_2 += j[1]
    lst.append([np.round(idx_1 / len(i),5), np.round(idx_2 / len(i), 5)])

df['MiddlePoint'] = lst
middle = df[['adm_cd', 'adm_nm', 'MiddlePoint']]
middle['adm_cd'] = pd.to_numeric(middle['adm_cd'])
```

ë²ˆì™¸ë¡œ, json í˜•ì‹ìœ¼ë¡œ ë˜ì–´ìˆëŠ” ì € txtíŒŒì¼ì„ geopandas í˜•íƒœë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì •ì—ì„œ ê½¤ ì• ë¥¼ ë¨¹ì—ˆëŠ”ë°

txtë¥¼ ë¶ˆëŸ¬ì„œ gpdë¡œ ë³€í™˜í•˜ì§€ ë§ê³  **ë°”ë¡œ gpd.read_file()ë¡œ ë¶ˆëŸ¬ì˜¤ë©´** ì‰½ê²Œ ë¶ˆëŸ¬ì™€ì§„ë‹¤! 

### 2) ë°ì´í„° filtering & concat

ì•ì—ì„œ ì–¸ê¸‰í•œ ê¸°ì¤€ëŒ€ë¡œ ë°ì´í„°ë¥¼ filteringí•˜ì—¬ ì „ë¶€ í•©ì³ì¤€ë‹¤. ì›ì²œ ë°ì´í„°ê°€ ê½¤ ì»¤ì„œ ì‹œê°„ì´ ì¢€ ì†Œìš”ëœë‹¤. 

```python
## ë°ì´í„° ê·œí•© 
def preprocess(df):
    data = df.copy()
    data = data[(data['ì¶œë°œ í–‰ì •ë™ ì½”ë“œ'] >= 1100000) & 
                (data['ì¶œë°œ í–‰ì •ë™ ì½”ë“œ'] <= 1200000) & 
                (data['ë„ì°© í–‰ì •ë™ ì½”ë“œ'] >= 1100000) & 
                (data['ë„ì°© í–‰ì •ë™ ì½”ë“œ'] <= 1200000)] # ì„œìš¸ì‹œ ë‚´ë¶€ ì´ë™ í•„í„°ë§ 

    data.loc[data['ì´ë™ì¸êµ¬(í•©)'] == '*', 'ì´ë™ì¸êµ¬(í•©)'] = 3  # * í‘œì‹œëŠ” 3ëª… ì´í•˜ë¼ëŠ” ëœ»ì´ë¯€ë¡œ 3ìœ¼ë¡œ ëŒ€ì²´ 
    data = data[data['ì´ë™ìœ í˜•'].isin(['EE', 'HE', 'WE'])] # ì§‘ê³¼ ì§ì¥ì´ ëª©ì ì¸ ê²½ìš° ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ì´ë™ ê²½ë¡œë§Œ
    data = data[data['ë‚˜ì´'].isin([20,25,30,35])] 
    data.drop(['í‰ê·  ì´ë™ ì‹œê°„(ë¶„)', 'ì´ë™ìœ í˜•', 'ë‚˜ì´'], axis=1, inplace=True)
    data.reset_index(drop=True, inplace=True)
    
    return data

def month_fit(path):
    df_list = os.listdir(path)
    final = pd.DataFrame()
    for i in tqdm(df_list):
        data = pd.read_csv(path + '\{}'.format(i), encoding='cp949')
        data = preprocess(data)
        final = pd.concat([final, data])
        del data 
    conditionlist = [    
        (final['ë„ì°©ì‹œê°„'].isin([3,4,5,6])), (final['ë„ì°©ì‹œê°„'].isin([7,8,9,10])),
        (final['ë„ì°©ì‹œê°„'].isin([11,12,13,14])), (final['ë„ì°©ì‹œê°„'].isin([15,16,17,18])),
        (final['ë„ì°©ì‹œê°„'].isin([19,20,21,22])), (final['ë„ì°©ì‹œê°„'].isin([23,0,1,2]))]
    choicelist = ['ìƒˆë²½(03-06)', 'ì•„ì¹¨(07-10)', 'ì ì‹¬(11-14)', 'ì˜¤í›„(15-18)', 'ì €ë…(19-22)', 'ë°¤(23-02)']
    final['time'] = np.select(conditionlist, choicelist, default='Not Specified')
    final['ì´ë™ì¸êµ¬(í•©)'] = pd.to_numeric(final['ì´ë™ì¸êµ¬(í•©)'])
    final = final.groupby(['ëŒ€ìƒì—°ì›”', 'ìš”ì¼', 'time','ì¶œë°œ í–‰ì •ë™ ì½”ë“œ', 
                           'ë„ì°© í–‰ì •ë™ ì½”ë“œ', 'ì„±ë³„'])['ì´ë™ì¸êµ¬(í•©)'].sum().reset_index()
    final = pd.merge(final, middle, left_on='ì¶œë°œ í–‰ì •ë™ ì½”ë“œ', right_on='adm_cd',how='left').dropna(axis=0)
    final = pd.merge(final, middle, left_on='ë„ì°© í–‰ì •ë™ ì½”ë“œ', right_on='adm_cd',how='left').dropna(axis=0)
    final = final.rename(columns = {'MiddlePoint_x' : 'start_point', 'MiddlePoint_y' : 'end_point'})
    final.drop(['adm_cd_x', 'adm_cd_y'], axis=1, inplace=True)
    
    return final

path = 'F:/Competitions/SeoulHotPlace/dataset/data'
path_list = os.listdir(path)
final = pd.DataFrame()
for idx in tqdm(path_list):
    path_2 = path+'\{}'.format(idx)
    dat = month_fit(path_2)
    final = pd.concat([final, dat])
    del dat
final.reset_index(drop=True, inplace=True)
```

### 3) ë°ì´í„° ì¶•ì†Œ ë° ì €ì¥

ë°ì´í„° í¬ê¸°ë¥¼ ì¡°ê¸ˆì´ë¼ë„ ì¶•ì†Œì‹œí‚¤ê¸° ìœ„í•´ ì²˜ë¦¬í•´ì¤€ë‹¤. csvë¡œ ê´€ë¦¬í•˜ë©´ ì˜¤ë¥˜ê°€ ë§ì•„ pickle íŒŒì¼ë¡œ ì €ì¥í•œë‹¤. 

```python
## ë°ì´í„° í¬ê¸° í™•ì¸ í•¨ìˆ˜
def mem_usage(pandas_obj):
    if isinstance(pandas_obj,pd.DataFrame):
        usage_b = pandas_obj.memory_usage(deep=True).sum()
    else: # we assume if not a df it's a series
        usage_b = pandas_obj.memory_usage(deep=True)
    usage_mb = usage_b / 1024 ** 2 # convert bytes to megabytes
    return "{:03.2f} MB".format(usage_mb)

## ì´ì‚°í˜• ë°ì´í„° ì‚¬ì´ì¦ˆ ì¶•ì†Œ í•¨ì†Œ
def int_memory_reduce(data) :
    data_int = data.select_dtypes(include=['int'])
    converted_int = data_int.apply(pd.to_numeric,downcast='unsigned')
    print(f"Before : {mem_usage(data_int)} -> After : {mem_usage(converted_int)}")
    data[converted_int.columns] = converted_int
    return data

## ì—°ì†í˜• ë°ì´í„° ì‚¬ì´ì¦ˆ ì¶•ì†Œ í•¨ì†Œ
def float_memory_reduce(data) :
    data_float = data.select_dtypes(include=['float'])
    converted_float = data_float.apply(pd.to_numeric,downcast='float')
    print(f"Before : {mem_usage(data_float)} -> After : {mem_usage(converted_float)}")
    data[converted_float.columns] = converted_float
    return data

final = float_memory_reduce(int_memory_reduce(final))

idx = final[(final['ì„±ë³„'] == 'M') |
         (final['time'] == "ìƒˆë²½(03-06)") |
         (final['ì´ë™ì¸êµ¬(í•©)'] == 3)].index
final.drop(idx, inplace=True)
final.drop(['ì¶œë°œ í–‰ì •ë™ ì½”ë“œ', 'ë„ì°© í–‰ì •ë™ ì½”ë“œ', 'ì„±ë³„'], axis=1, inplace=True)

with open('./final_ver2.pickle', 'wb') as f:
    pickle.dump(final, f, pickle.HIGHEST_PROTOCOL)
```

### 4) ì„œìš¸ì‹œ ê²½ê³„ë©´ ë°ì´í„° ì²˜ë¦¬

ì„œìš¸ì‹œê°€ ë©”ì¸ì´ë¯€ë¡œ ê°•ì¡°í•´ì£¼ê¸° ìœ„í•´ pydeck layerë¡œ ìŒ“ì•„ì¤„ ê²½ê³„ë©´ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•´ì¤€ë‹¤. 

```python
dff = gpd.read_file('https://raw.githubusercontent.com/heumsi/geo_data_visualisation_introduction/master/data/older_seoul.geojson')
def multipolygon_to_coordinates(x):
    lon, lat = x[0].exterior.xy
    return [[x, y] for x, y in zip(lon, lat)]
dff['coordinates'] = dff['geometry'].apply(multipolygon_to_coordinates)
del dff['geometry'], dff['ì¸êµ¬'], dff['ë‚¨ì'], dff['ì—¬ì']
dff = pd.DataFrame(dff)

with open('./seoul_boundary.pickle', 'wb') as f:
    pickle.dump(dff, f, pickle.HIGHEST_PROTOCOL)
```

## Mapping

---

ê°€ì¥ ì¤‘ìš”í•œ layer ê·¸ë¦¬ê¸°ì´ë‹¤. **ëª©í‘œëŠ” ë…„ì›”, ìš”ì¼, ì‹œê°„ëŒ€, ìƒìœ„ Nê°œ dataë¥¼ ê³ ë¥´ë©´ ê·¸ì— ë§ëŠ” arc layerë¥¼ ê·¸ë ¤ì£¼ëŠ” ê²ƒì´ë‹¤.** 

**dash ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ interactiveí•˜ê²Œ inputì„ ì…ë ¥ë°›ì•„ pydeck ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ layerë¥¼ ìŒ“ì•„ ì§€ë„ìœ„ì— ê·¸ë¦¬ëŠ” ë°©ì‹**ìœ¼ë¡œ í•´ê²°í•˜ì˜€ë‹¤. 

```python
import dash
import os
from dash import dcc, html
from dash.dependencies import Input, Output
import pickle
import dash_deck
import pydeck as pdk
os.chdir('F:/Competitions/SeoulHotPlace')
mapbox_api_token = 'pk.eyJ1IjoiYm94Ym94NCIsImEiOiJjbDdoY2J1bm8wNzlrM3BycDQzYmduNTJtIn0.Q7koz2UNld3b1xmqF7-KXA'
with open('./final_ver2.pickle', 'rb') as f:
    df = pickle.load(f)
with open('./seoul_boundary.pickle', 'rb') as f:
    dff = pickle.load(f)
```

### 1) pydeck layer

dashë¡œ ì…ë ¥ë°›ì€ inputë“¤ì„ ë‚´ë¶€ì—ì„œ filteringí•˜ì—¬ normalizedëœ ì´ë™ì¸êµ¬(í•©) ë°ì´í„°ë¥¼ ì¶œë°œâ†’ë„ì°© í–‰ì •ë™ì„ ê¸°ì¤€ìœ¼ë¡œ 3d ê³¡ì„ ì„ ê·¸ë ¤ì¤€ë‹¤. 

ì¶œë°œì€ ë¹¨ê°„ìƒ‰, ë„ì°©ì€ ì´ˆë¡ìƒ‰ì´ë‹¤. boundary layerëŠ” ì•ì—ì„œ ì²˜ë¦¬í•œ ì„œìš¸ì‹œ ê²½ê³„ layerë¡œ ì„œìš¸ì‹œë¥¼ êµ¬ë¶„í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. 

```python
def create_map(month, day, time, top):
    new_df = df[(df['ëŒ€ìƒì—°ì›”'] == month) &
                (df['ìš”ì¼'] == day) &
                (df['time'] == time)]
    new_df = new_df.sort_values('ì´ë™ì¸êµ¬(í•©)', ascending=False)
    new_df['normalized_ì´ë™ì¸êµ¬'] = new_df['ì´ë™ì¸êµ¬(í•©)'] / new_df['ì´ë™ì¸êµ¬(í•©)'].max()
    new = new_df.iloc[0:top,:].copy()
    
    # boundary layer 
    boundary_layer = pdk.Layer(
        'PolygonLayer',
        dff,
        get_polygon = 'coordinates',
        get_fill_color = '[128, 128, 128]',
        pickable = True,
        auto_highlight = True,
        opacity = 0.05
    )
    
    # arc layer
    arc_layer = pdk.Layer(
        "ArcLayer",
        new,
        get_source_position='start_point',
        get_target_position='end_point',
        get_tilt=15,
        get_width='1 + 100 * normalized_ì´ë™ì¸êµ¬',
        get_source_color='[255, 0, 0]',
        get_target_color='[0, 255, 0]',
        pickable=True,
        auto_highlight=True,
    )
    center = [126.986, 37.565]
    view_state = pdk.ViewState(longitude=center[0], latitude=center[1])
    view_state.zoom = 11
    view_state.bearing = -15
    view_state.pitch = 45

    r = pdk.Deck(layers = [boundary_layer, arc_layer], initial_view_state=view_state, mapbox_key= mapbox_api_token)
    
    return r
```

ì´ layerë¥¼ ì§€ë„ì— ë„ìš°ëŠ” ê²ƒ ìì²´ë§Œìœ¼ë¡œë„ ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆëŠ”ë° ì£¼ëœ ì˜¤ë¥˜ëŠ”, 

1. mapbox api token ê°’ì„ layerì— ì ìš©ì‹œí‚¤ëŠ” ê²ƒ â‡’ í™˜ê²½ ë³€ìˆ˜ë¡œ ì €ì¥í•´ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ê·¸ëƒ¥ ì†í¸í•˜ê²Œ ì§ì ‘ ì„ ì–¸í•´ì£¼ì.
2. ì¶”í›„ dashì™€ì˜ ì—°ë™ì—ì„œ dash_deckê³¼ mapbox api tokenê°’ì„ ì—°ë™ì‹œí‚¤ëŠ”ë° ì• ë¥¼ ë¨¹ì—ˆë‹¤. â‡’ **pydeck ë²„ì „ 0.5.0ìœ¼ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œ** í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.
pydeckê³¼ dash_deck ì½”ë“œë“¤ì€ ëª¨ë‘ 0.5.0 ë²„ì „ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆë‹¤. 

### 2) dash - app.layout

í”„ë¡ íŠ¸ì—”ë“œë¥¼ ê°„ì ‘ì ìœ¼ë¡œ ê²½í—˜í•˜ì˜€ë‹¤. html ì–¸ì–´ë¥¼ pythonì—ì„œ ì‰½ê²Œ ì§¤ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” íˆ´ì¸ë° **ìƒìƒí•˜ëŠ”ë°ë¡œ êµ¬ì¡°ë¥¼ ì§œê¸°ê°€ ìµìˆ™í•´ì§€ê¸° ì „ì—” í˜ë“¤ì—ˆë‹¤.**

ë²„íŠ¼ë“¤ì„ ìœ„ìª½ì— ì¼ìë¡œ ì´ì˜ê²Œ ë§Œë“œëŠ” ê²ƒì´ ëª©í‘œì˜€ëŠ”ë° **ë²„íŠ¼êµ¬ì¡° í•˜ë‚˜í•˜ë‚˜ë‹¹ ì¶”ê°€ì ì¸ html.Divë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•ˆ ê²ƒì€ ê±°ì˜ ë„íŠ¸ë¨¸ë¦¬ì˜€ë‹¤â€¦.**

êµ¬ì¡°ëŠ” í¬ê²Œ html.Div ì•ˆì— í•´ë‹¹ ë„¤ëª¨ë°•ìŠ¤ë¥¼ ê¾¸ë°€ **style**ê³¼ app.callbackê³¼ ì—°ê²°ë˜ì–´ inputê°’ì„ ì¡°ì •í•  **children** íŒŒíŠ¸ë¡œ ë‚˜ë‰œë‹¤. 

í•˜ë‚˜ë§Œ ê°€ì ¸ì™€ë³´ë©´ ì´ëŸ°ì‹ìœ¼ë¡œ Div(ë„¤ëª¨ë°•ìŠ¤) ì•ˆì— ë˜ë‹¤ë¥¸ Div(ë„¤ëª¨ë°•ìŠ¤)ë¥¼ ë§Œë“¤ê³  styleì„ ì •í•˜ê³  dcc.~~~ ë¡œ ì–´ë–¤ ë²„íŠ¼ì„ ë§Œë“¤ì§€ë¥¼ ì •í•œë‹¤. 

```python
html.Div(children = [
            html.H4('Month', style = {'color' : colors['text']}),
            html.Div(style = {"width" : "100%", "display" : "inline-block", 
                              "vertical-align" : "top", 'color' : colors['text']}, children = [
                dcc.Slider(
                    min = df["ëŒ€ìƒì—°ì›”"].min(),
                    max = df["ëŒ€ìƒì—°ì›”"].max(),
                    step = None,
                    value = df["ëŒ€ìƒì—°ì›”"].min(),
                    marks = {int(month) : str(month) for month in df["ëŒ€ìƒì—°ì›”"].unique()},
                    id = "month_slider")
            ]),
        ], style = {"display" : "inline-block", 'width' : '25%', "vertical-align" : "top"}),
```

![Untitled](%E1%84%89%E1%85%A5%E1%84%8B%E1%85%AE%E1%86%AF%E1%84%89%E1%85%B5%E1%84%8B%E1%85%B4%20%E1%84%92%E1%85%A1%E1%86%BA%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%83%E1%85%B5%20(1%202)%209d6046a2385748d69e039c32b4c53ab0/Untitled%202.png)

```python
colors = {
    'background': '#111111',
    'text': '#ffffff'
}
app = dash.Dash(__name__)
app.layout = html.Div(
    style={'backgroundColor': colors['background'], 'width' : '100%'}, children = [
        html.Div(children = [
            html.H1('ã…¤A Floatting Map of Seoul', style = {'color' : colors['text']})
            ], style = {"display" : "inline-block", 'width' : '30%', "vertical-align" : "top"}),
        
        html.Div(children = [
            html.H4('Month', style = {'color' : colors['text']}),
            html.Div(style = {"width" : "100%", "display" : "inline-block", 
                              "vertical-align" : "top", 'color' : colors['text']}, children = [
                dcc.Slider(
                    min = df["ëŒ€ìƒì—°ì›”"].min(),
                    max = df["ëŒ€ìƒì—°ì›”"].max(),
                    step = None,
                    value = df["ëŒ€ìƒì—°ì›”"].min(),
                    marks = {int(month) : str(month) for month in df["ëŒ€ìƒì—°ì›”"].unique()},
                    id = "month_slider")
            ]),
        ], style = {"display" : "inline-block", 'width' : '25%', "vertical-align" : "top"}),
                                  
        html.Div(children = [
            html.H4('Weekday', style = {'color' : colors['text'], 'textAlign': 'top'}),
            html.Div(style = {"width" : "80%", "display" : "inline-block", "vertical-align" : "top"}, children = [
                dcc.Dropdown([{'label':'ì›”(Mon)', 'value' : 'ì›”'},
                              {'label':'í™”(Tue)', 'value' : 'í™”'},
                              {'label':'ìˆ˜(Wed)', 'value' : 'ìˆ˜'},
                              {'label':'ëª©(Thur)', 'value' : 'ëª©'},
                              {'label':'ê¸ˆ(Fri)', 'value' : 'ê¸ˆ'},
                              {'label':'í† (Sat)', 'value' : 'í† '},
                              {'label':'ì¼(Sun)', 'value' : 'ì¼'}], 'ì›”', id = "day_dropdown")
            ]),
        ], style = {"display" : "inline-block", 'width' : '10%', "vertical-align" : "top"}),
        
        html.Div(children = [
            html.H4('Time', style = {'color' : colors['text'], 'textAlign': 'top'}),    
            html.Div(style = {"width" : "80%", "display" : "inline-block", "vertical-align" : "top"}, children = [
                dcc.Dropdown(['ì•„ì¹¨(07-10)', 'ì ì‹¬(11-14)', 'ì˜¤í›„(15-18)', 'ì €ë…(19-22)', 'ë°¤(23-02)'], 'ì ì‹¬(11-14)', 
                             id = "time_dropdown")
            ]),
        ], style = {"display" : "inline-block", 'width' : '10%', "vertical-align" : "top"}),
        
        html.Div(children = [
            html.H4('Top N of data', style = {'color' : colors['text'], 'display': 'inline-block', "vertical-align" : "top"}),
            html.Div(style = {"width" : "80%", 'display': 'inline-block', "vertical-align" : "top"}, children = [
                dcc.Input(id = "max_rows", value = 500, type = "number", style = {"width" : "80%"})
            ]),
        ], style = {"display" : "inline-block", 'width' : '10%', "vertical-align" : "top"}),
        
        html.Div(children = [
            html.H4('Color Description', style = {'color' : colors['text'], 'display': 'inline-block', "vertical-align" : "top"}),
            html.Div(style = {"width" : "80%", "display" : "inline-block", "vertical-align" : "bottom", 'color' : colors['text'],
                              "height" : "50px"}, children = [
                dcc.Markdown('''
                      source color : red      
                      target color : green 
                ''')
                ])
        ], style = {"display" : "inline-block", 'width' : '15%', "vertical-align" : "top"}),

        html.Br(),
        html.Br(),
        html.Div(
            id = 'deck-gl',
            style={
                "width": "90%",
                "padding-left" : "5%",
                "padding-right" : "5%",
                "height": "83vh",
                "display": "inline-block",
                "position": "relative",
                },
            children = []
            )
])
```

**ë…„ì›”ì€ ìŠ¬ë¼ì´ë” í˜•íƒœë¡œ, ìš”ì¼ê³¼ ì‹œê°„ëŒ€ëŠ” dropdown í˜•íƒœë¡œ, top n ì€ ì§ì ‘ ì…ë ¥í•˜ëŠ” í˜•íƒœ**ë¡œ ë²„íŠ¼ì„ ë§Œë“¤ì–´ì¤€ë‹¤. 

### 3) dash - app.callback

layoutê³¼ ë°”ë¡œ ë°‘ì— ë¶™ì–´ìˆëŠ” í•¨ìˆ˜ì˜ inputê³¼ outputì´ ê°ê° ì–´ë–»ê²Œ ì—°ë™í• ì§€ë¥¼ idë¥¼ í†µí•´ ì„ ì–¸í•´ì¤€ë‹¤. 

ì•ì—ì„œ ë…„ì›”, ìš”ì¼, ì‹œê°„ëŒ€, top nê°œ ë¥¼ ì¡°ì •í•  ê²ƒì´ë¼ê³  í–ˆìœ¼ë‹ˆ ë‹¹ì—°íˆ í•¨ìˆ˜ì˜ **inputë„ 4ê°œ**ì´ë‹¤. 

ë‹¤ë§Œ **ëª¨ë“  inputì„ ë°›ì•„ì„œ í•˜ë‚˜ì˜ ì§€ë„ì— ì „ë¶€ í•©ì³ì„œ ê·¸ë¦´ ì˜ˆì •ì´ë‹ˆ outputì€ í•˜ë‚˜**ì´ë‹¤. 

```python
@app.callback(
    Output(component_id = "deck-gl", component_property = "children"),
    Input(component_id = "month_slider", component_property = "value"),
    Input(component_id = "day_dropdown", component_property = "value"),
    Input(component_id = "time_dropdown", component_property = "value"),
    Input(component_id = "max_rows", component_property = "value")
)
def update_contents(month, day, time, top):
    r = create_map(month, day, time, top)
    return dash_deck.DeckGL(r.to_json(), id = 'deck_gl', tooltip=True, mapboxKey=r.mapbox_key)

if __name__ == "__main__":
    app.run_server(debug=True)
```

ì—¬ê¸°ì„œë„ ê½¤ ë§ì´ í—¤ë§¸ë‹¤. ì§€ë„ë§Œ ë”± ë‚˜ì˜¤ê³  layerê°€ ê·¸ë ¤ì§€ì§€ ì•ŠëŠ”ë‹¤ê±°ë‚˜, ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ë“¤ì´ ëœ¬ë‹¤ê±°ë‚˜, time outì´ ëœë‹¤ê±°ë‚˜â€¦

ê²°êµ­ì—” pydeckì˜ ë²„ì „ì„ 0.5.0 ìœ¼ë¡œ ë‚®ì¶”ê³  dash_deck.DeckGL í•¨ìˆ˜ë¥¼ update_contents()ì˜ return ê°’ìœ¼ë¡œ ì£¼ì–´ í•´ê²°í•˜ì˜€ë‹¤. 

pydeckê³¼ dashë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ì‚¬ëŒì´ ë˜ ìˆë‹¤ë©´ í—¤ë§¤ì§€ ë§ê³  ë°”ë¡œ ì €ë ‡ê²Œ ì“°ê¸¸ ë°”ë€ë‹¤. 

## Visualization

---

ì´ì œ ë‹¤ ë§Œë“¤ì—ˆìœ¼ë‹ˆ í™•ì¸í•´ë³¼ ì°¨ë¡€ë‹¤. 

conda prompt ì°½ì„ ì—´ì–´ì„œ mappingì„ ìœ„í•´ ë§Œë“  py íŒŒì¼ì„ python floating_mapping.py ì´ë ‡ê²Œ ì¹˜ê³  ì—´ë©´ ì´ëŸ°ì‹ìœ¼ë¡œ ëœ¬ë‹¤.

```python
Dash is running on http://127.0.0.1:8050/

 * Serving Flask app 'floating_mapping' (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
```

ì € ë§í¬ì£¼ì†Œë¥¼ ì¸í„°ë„· ì°½ì— ì…ë ¥í•˜ë©´ ë“œë””ì–´ interactiveí•œ ì§€ë„ê°€ ë“±ì¥í•˜ëŠ” ê²ƒì´ë‹¤. 

![Untitled](%E1%84%89%E1%85%A5%E1%84%8B%E1%85%AE%E1%86%AF%E1%84%89%E1%85%B5%E1%84%8B%E1%85%B4%20%E1%84%92%E1%85%A1%E1%86%BA%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%83%E1%85%B5%20(1%202)%209d6046a2385748d69e039c32b4c53ab0/Untitled%203.png)

2022ë…„ 4ì›”, ì¼ìš”ì¼ ì €ë… ì‹œê°„ëŒ€(19ì‹œ-22ì‹œ) ì„œìš¸ ì‹œì˜ ìƒìœ„ 500ê°œ ìœ ë™ì¸êµ¬ì˜ í˜•íƒœì´ë‹¤. 

ì§‘ì´ë‚˜ íšŒì‚¬ê°€ ê´€ë ¨ëœ í˜•íƒœì˜ ì´ë™ìœ í˜•ì€ ëºìœ¼ë‹ˆ ìˆœì „íˆ ë†€ê±°ë‚˜ ì•½ì†ì„ ì¡ê±°ë‚˜ í•˜ëŠ” í˜•íƒœì˜ ì›€ì§ì„ë“¤ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤. (ì•¼ê·¼ëŸ¬ë“¤ì—ê² ë¯¸ì•ˆí•˜ë‹¤â€¦)

ëŒ€ëµì ìœ¼ë¡œ ì‚´í´ë³´ë©´, ì—¬ì˜ë„ì—ì„œ ì¶œë°œí•˜ëŠ” ê²½ìš°ë„ ë§ì´ ë³´ì´ê³  ìš©ì‚°, ì´íƒœì›, í™ëŒ€, ì‹ ì´Œ, ê±´ëŒ€ë¡œ ë§ì´ ë“¤ì–´ê°€ê³  ìˆë‹¤. ì—­ì‚¼, ì„œì´ˆ ìª½ì€ ìœ ì…, ìœ ì¶œ ì¸êµ¬ê°€ ë§¤ìš° ë§ë‹¤. 

**ëŒ€ë¶€ë¶„ì˜ í•«í”Œë ˆì´ìŠ¤ ì˜ˆìƒ ì§€ì—­ë“¤ì´ ì˜ ë³´ì´ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.** 

ì—¬ê¸°ì„œ ì‹œê°„ëŒ€ë§Œ ë°¤ìœ¼ë¡œ ë°”ê¾¸ë©´, 

![Untitled](%E1%84%89%E1%85%A5%E1%84%8B%E1%85%AE%E1%86%AF%E1%84%89%E1%85%B5%E1%84%8B%E1%85%B4%20%E1%84%92%E1%85%A1%E1%86%BA%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%83%E1%85%B5%20(1%202)%209d6046a2385748d69e039c32b4c53ab0/Untitled%204.png)

ì´ëŸ°ì‹ìœ¼ë¡œ ë°”ë€ë‹¤. ì €ë… ì‹œê°„ëŒ€ë³´ë‹¤ ë” ë§ì€ ì‚¬ëŒë“¤ì´ í™ëŒ€ì™€ ê°•ë‚¨ìœ¼ë¡œ ì´ë™í•˜ê³  ë¹ ì ¸ë‚˜ì˜¤ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. 

UIëŠ” ìƒë‹¹íˆ ê°„ë‹¨í•˜ê³  ì¡°ì¡í•˜ì§€ë§Œ interactiveí•˜ê²Œ êµ¬í˜„í–ˆë‹¤ëŠ”ë° ë§¤ìš° ë¿Œë“¯í–ˆë‹¤. 

ì´ì œ ì´ ì§€ë„ë¥¼ **ìƒˆë¡œ ë§Œë“¤ ì‚¬ì´íŠ¸**ì— ì§‘ì–´ë„£ê¸°ë§Œ í•˜ë©´ ëœë‹¤! 

**ìƒê°ë³´ë‹¤ ê¸¸ì–´ì ¸ì„œ 2ë¶€ë¡œ ë„˜ê¸°ë ¤ê³  í•œë‹¤.**

[ì„œìš¸ì‹œì˜ í•«í”Œë ˆì´ìŠ¤ëŠ” ì–´ë””? (2/2)](https://www.notion.so/2-2-ccde91c6956c407e906e79fec095edfe)

# References

[admdongkor/ver20220401 at master Â· vuski/admdongkor](https://github.com/vuski/admdongkor/tree/master/ver20220401)

[ì„œìš¸ ìƒí™œì´ë™](https://data.seoul.go.kr/dataVisual/seoul/seoulLivingMigration.do)

[[ Python ] ì •í˜•ë°ì´í„° ìš©ëŸ‰ ì¤„ì´ëŠ” í•¨ìˆ˜ ì†Œê°œ (ì—°ì†í˜•, ì´ì‚°í˜•, ë¬¸ìí˜•)](https://data-newbie.tistory.com/472)
